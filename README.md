# ПЛР4: Файловая система

**Выполнил:** Пасечник Иван Андреевич, P3331, оценка 4/5

**Преподаватель:** Дворкин Борис Александрович

## Описание

Модуль ядра Linux для своей файловой системы VTFS. Файлы хранятся в памяти и могут синхронизироваться с сервером.

## Архитектура

### Структуры ядра

- **superblock** — описание файловой системы, хранит ссылку на корень
- **inode** — метаданные файла (номер, тип, права, размер)
- **dentry** — связь между именем файла и inode

### Хранилище (storage.c)

Все файлы хранятся в связном списке структур `vtfs_entry`:
```
vtfs_entry {
    name, ino, mode, size
    data[]          — содержимое файла
    children[]      — дочерние элементы (для директорий)
    parent          — родительская директория
}
```

### Операции

| Структура | Функции | Назначение |
|-----------|---------|------------|
| `inode_operations` | lookup, create, unlink, mkdir, rmdir, link | Работа с метаданными |
| `file_operations` | read, write, iterate | Работа с содержимым |

### Поток данных

```
Пользователь (ls, cat, touch)
        ↓
    VFS ядра
        ↓
  vtfs_inode_ops / vtfs_file_ops
        ↓
    storage.c (RAM)
        ↓
    http.c → Сервер → PostgreSQL
```

## Реализовано

- Монтирование файловой системы
- Просмотр содержимого директорий
- Создание/удаление файлов и папок
- Чтение и запись файлов
- Жёсткие ссылки
- Сервер на Spring Boot + PostgreSQL

## API сервера

| Метод | Описание |
|-------|----------|
| `/list?path=` | Список файлов в директории |
| `/create?path=&type=&mode=` | Создать файл или папку |
| `/delete?path=` | Удалить файл или папку |
| `/read?path=&offset=&size=` | Прочитать файл |
| `/write?path=&offset=&data=` | Записать в файл |
| `/stat?path=` | Информация о файле |
| `/link?oldpath=&newpath=` | Создать жёсткую ссылку |

## Запуск

```bash
# Запустить сервер (в отдельном терминале)
cd server
./gradlew bootRun

# Собрать и загрузить модуль
cd module
make
sudo insmod vtfs.ko token="test_token"
sudo mount -t vtfs none /mnt/vtfs
```

## Остановка

```bash
sudo umount /mnt/vtfs
sudo rmmod vtfs
```

## Тестирование

```bash
./test.sh
```

Скрипт проверяет:
- Базовые операции с файлами (создание, чтение, удаление)
- Операции с директориями (mkdir, rmdir, ls)
- Вложенные директории (3 уровня)
- Множественные файлы (10 штук)
- Персистентность после перемонтирования
